name: Generate Deployment QR Codes

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  generate-qr:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install QR code generator
        run: npm install -g qrcode

      - name: Create QR codes directory
        run: mkdir -p qr-codes

      - name: Generate Frontend QR Code
        run: |
          # Vercel ë°°í¬ URL
          FRONTEND_URL="https://bs-hr-system.vercel.app"
          echo "Generating QR code for Frontend: $FRONTEND_URL"
          qrcode -o qr-codes/frontend-qr.png "$FRONTEND_URL"

          # QR ì½”ë“œ ì •ë³´ ì €ì¥
          echo "Frontend URL: $FRONTEND_URL" > qr-codes/deployment-info.txt
          echo "Generated at: $(date)" >> qr-codes/deployment-info.txt

      - name: Generate Backend QR Code
        run: |
          # Railway ë°±ì—”ë“œ URL
          BACKEND_URL="https://bshrsystem-production.up.railway.app"
          echo "Generating QR code for Backend: $BACKEND_URL"
          qrcode -o qr-codes/backend-qr.png "$BACKEND_URL"

          # QR ì½”ë“œ ì •ë³´ ì¶”ê°€
          echo "" >> qr-codes/deployment-info.txt
          echo "Backend URL: $BACKEND_URL" >> qr-codes/deployment-info.txt

      - name: Generate Combined Info QR Code
        run: |
          # ì „ì²´ ë°°í¬ ì •ë³´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ
          INFO_JSON='{"frontend":"https://bs-hr-system.vercel.app","backend":"https://bshrsystem-production.up.railway.app","updated":"'$(date -Iseconds)'"}'
          echo "Generating combined info QR code"
          qrcode -o qr-codes/deployment-info-qr.png "$INFO_JSON"

      - name: Create HTML page with QR codes
        run: |
          cat > qr-codes/index.html <<'EOF'
          <!DOCTYPE html>
          <html lang="ko">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>ë¶€ì„±ìŠ¤í‹¸ HR ì‹œìŠ¤í…œ - ë°°í¬ QR ì½”ë“œ</title>
              <style>
                  body {
                      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                      max-width: 1200px;
                      margin: 0 auto;
                      padding: 40px 20px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      min-height: 100vh;
                  }
                  .container {
                      background: white;
                      border-radius: 20px;
                      padding: 40px;
                      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                  }
                  h1 {
                      text-align: center;
                      color: #333;
                      margin-bottom: 10px;
                      font-size: 2.5em;
                  }
                  .subtitle {
                      text-align: center;
                      color: #666;
                      margin-bottom: 40px;
                      font-size: 1.1em;
                  }
                  .qr-grid {
                      display: grid;
                      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                      gap: 30px;
                      margin-top: 40px;
                  }
                  .qr-card {
                      background: #f8f9fa;
                      border-radius: 15px;
                      padding: 30px;
                      text-align: center;
                      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                      transition: transform 0.3s ease, box-shadow 0.3s ease;
                  }
                  .qr-card:hover {
                      transform: translateY(-5px);
                      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
                  }
                  .qr-card h2 {
                      color: #667eea;
                      margin-bottom: 20px;
                      font-size: 1.5em;
                  }
                  .qr-card img {
                      max-width: 100%;
                      height: auto;
                      border-radius: 10px;
                      margin: 20px 0;
                      background: white;
                      padding: 15px;
                  }
                  .url {
                      background: white;
                      padding: 12px 20px;
                      border-radius: 8px;
                      margin: 15px 0;
                      word-break: break-all;
                      font-family: 'Courier New', monospace;
                      font-size: 0.9em;
                      color: #495057;
                      border: 2px solid #e9ecef;
                  }
                  .badge {
                      display: inline-block;
                      padding: 6px 15px;
                      background: #667eea;
                      color: white;
                      border-radius: 20px;
                      font-size: 0.85em;
                      margin-top: 10px;
                  }
                  .info-section {
                      background: #e7f3ff;
                      border-left: 4px solid #667eea;
                      padding: 20px;
                      margin: 30px 0;
                      border-radius: 8px;
                  }
                  .info-section h3 {
                      color: #667eea;
                      margin-top: 0;
                  }
                  .timestamp {
                      text-align: center;
                      color: #888;
                      margin-top: 40px;
                      font-size: 0.9em;
                  }
                  @media (max-width: 768px) {
                      body { padding: 20px 10px; }
                      .container { padding: 20px; }
                      h1 { font-size: 1.8em; }
                      .qr-grid { grid-template-columns: 1fr; }
                  }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>ğŸ¢ ë¶€ì„±ìŠ¤í‹¸ HR ì‹œìŠ¤í…œ</h1>
                  <p class="subtitle">ë°°í¬ í™˜ê²½ QR ì½”ë“œ</p>

                  <div class="info-section">
                      <h3>ğŸ“± ì‚¬ìš© ë°©ë²•</h3>
                      <p>ìŠ¤ë§ˆíŠ¸í° ì¹´ë©”ë¼ë¡œ QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ë©´ í•´ë‹¹ ì„œë¹„ìŠ¤ì— ë°”ë¡œ ì ‘ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                      <ul>
                          <li><strong>Frontend</strong>: ì‚¬ìš©ìê°€ ì ‘ì†í•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜</li>
                          <li><strong>Backend</strong>: API ì„œë²„ ìƒíƒœ í™•ì¸</li>
                      </ul>
                  </div>

                  <div class="qr-grid">
                      <div class="qr-card">
                          <h2>ğŸŒ Frontend</h2>
                          <div class="badge">Vercel</div>
                          <img src="frontend-qr.png" alt="Frontend QR Code">
                          <div class="url">https://bs-hr-system.vercel.app</div>
                          <p style="color: #666; margin-top: 15px;">ë©”ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜</p>
                      </div>

                      <div class="qr-card">
                          <h2>ğŸ”§ Backend</h2>
                          <div class="badge">Railway</div>
                          <img src="backend-qr.png" alt="Backend QR Code">
                          <div class="url">https://bshrsystem-production.up.railway.app</div>
                          <p style="color: #666; margin-top: 15px;">API ì„œë²„</p>
                      </div>

                      <div class="qr-card">
                          <h2>ğŸ“‹ ë°°í¬ ì •ë³´</h2>
                          <div class="badge">JSON Format</div>
                          <img src="deployment-info-qr.png" alt="Deployment Info QR Code">
                          <p style="color: #666; margin-top: 15px;">ì „ì²´ ë°°í¬ ì •ë³´ (JSON)</p>
                      </div>
                  </div>

                  <div class="timestamp" id="timestamp">
                      ìƒì„± ì‹œê°„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                  </div>
              </div>

              <script>
                  // íƒ€ì„ìŠ¤íƒ¬í”„ ì—…ë°ì´íŠ¸
                  fetch('deployment-info.txt')
                      .then(response => response.text())
                      .then(text => {
                          const match = text.match(/Generated at: (.+)/);
                          if (match) {
                              document.getElementById('timestamp').textContent =
                                  'ìµœì¢… ì—…ë°ì´íŠ¸: ' + match[1];
                          }
                      })
                      .catch(() => {
                          document.getElementById('timestamp').textContent =
                              'ìµœì¢… ì—…ë°ì´íŠ¸: ' + new Date().toLocaleString('ko-KR');
                      });
              </script>
          </body>
          </html>
          EOF

      - name: Upload QR codes as artifacts
        uses: actions/upload-artifact@v4
        with:
          name: deployment-qr-codes
          path: qr-codes/
          retention-days: 90

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./qr-codes
          publish_branch: gh-pages
          force_orphan: true

      - name: Create deployment summary
        run: |
          echo "## ğŸ‰ QR ì½”ë“œ ìƒì„± ì™„ë£Œ!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“± ìƒì„±ëœ QR ì½”ë“œ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Frontend**: https://bs-hr-system.vercel.app" >> $GITHUB_STEP_SUMMARY
          echo "- **Backend**: https://bshrsystem-production.up.railway.app" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ”— QR ì½”ë“œ í˜ì´ì§€" >> $GITHUB_STEP_SUMMARY
          echo "GitHub Pagesì—ì„œ í™•ì¸: https://eunsujeong.github.io/BS_HR_System/" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“¦ ë‹¤ìš´ë¡œë“œ" >> $GITHUB_STEP_SUMMARY
          echo "Actions íƒ­ì˜ Artifactsì—ì„œ QR ì½”ë“œ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." >> $GITHUB_STEP_SUMMARY
